<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

 <!-- 리뷰 조회 (최신순) -->
 <select id="selectReview" parameterType="ReviewDto" resultType="ReviewDto">
  	select * from review
  	where goods_id = #{goods_id} or goods_id = 0
  	order by review_asc desc
 </select>
 
  <!-- 리뷰 조회 (추천순) -->
 <select id="selectReviewOrderbyLikes" parameterType="ReviewDto" resultType="ReviewDto">
  	select * from review
  	where goods_id = #{goods_id} or goods_id = 0
  	order by Likes_count desc
 </select>
 
   <!-- 리뷰 조회 (내가 쓴 글 보기) -->
 <select id="selectReviewOrderbyUserId" parameterType="ReviewDto" resultType="ReviewDto">
  	select * from review
  	where (goods_id = #{goods_id} or goods_id = 0) 
  	and (user_id = #{user_id} or user_id like CONCAT('%admin%'))
  	order by review_asc desc
 </select>
 
 
 <!-- 좋아요 갯수 업데이트 -->
 <update id="updateLikes" parameterType="ReviewDto">
 	update review
 	set likes_count = #{likes_count}
 	where review_id = #{review_id}
 </update>
 
  <!-- 좋아요 갯수 조회 --> 
 <select id="countLikes" parameterType="LikesDto" resultType="LikesDto">
  	select * from likes
  	where review_id = #{review_id} and likes_isLike = 1
 </select>

  <!-- MaxReview_id 조회 -->
 <select id="MaxReview_id" resultType="integer">
  	select max(review_id)
  	from review
 </select>
 
  <!-- MaxReview_asc 조회 -->
 <select id="MaxReview_asc" resultType="integer">
  	select max(review_asc)
  	from review
  	where goods_id = #{goods_id}
 </select>

 <!-- 리뷰 추가 -->
 <insert id="insertReview" parameterType="ReviewDto">
 	insert into review (goods_id, user_id, review_title, review_content, review_viewCount,
 	review_star, review_isPrivate, review_asc, review_answer, review_date)
 	values(#{goods_id},#{user_id},#{review_title},#{review_content},0,
 	#{review_star},#{review_isPrivate},#{review_asc},0,now())
 </insert>
</mapper>